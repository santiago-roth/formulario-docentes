<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Visitas - Museo Scasso</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .form-header {
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        
        .form-header h2 {
            color: var(--primary-color);
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-group label.required:after {
            content: " *";
            color: var(--accent-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .radio-group, .checkbox-group {
            margin-top: 10px;
        }
        
        .radio-option, .checkbox-option {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .radio-option input, .checkbox-option input {
            margin-right: 10px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #c0392b;
        }
        
        .calendar-container {
            margin-top: 30px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background-color: var(--light-color);
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 500;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 4px;
        }
        
        .calendar-day {
            height: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            position: relative;
        }
        
        .calendar-day-number {
            position: absolute;
            top: 5px;
            right: 5px;
            font-weight: 500;
        }
        
        .calendar-day.available {
            background-color: rgba(46, 204, 113, 0.1);
            cursor: pointer;
        }
        
        .calendar-day.available:hover {
            background-color: rgba(46, 204, 113, 0.2);
        }
        
        .calendar-day.booked {
            background-color: rgba(231, 76, 60, 0.1);
            color: #999;
        }
        
        .calendar-day.other-month {
            opacity: 0.5;
        }
        
        .calendar-day.today {
            border: 2px solid var(--secondary-color);
        }
        
        .time-slots {
            display: none;
            margin-top: 20px;
        }
        
        .time-slots.active {
            display: block;
        }
        
        .time-slot {
            display: inline-block;
            padding: 8px 15px;
            margin: 0 10px 10px 0;
            background-color: var(--light-color);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .time-slot:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .time-slot.selected {
            background-color: var(--success-color);
            color: white;
        }
        
        .time-slot.booked {
            background-color: #eee;
            color: #999;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .progress-bar:before {
            content: "";
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }
        
        .progress-step {
            position: relative;
            z-index: 2;
            text-align: center;
            width: 100%;
        }
        
        .progress-step:not(:last-child) {
            margin-right: 10px;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: #666;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .step-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-step.active .step-number {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .progress-step.active .step-label {
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        .progress-step.completed .step-number {
            background-color: var(--success-color);
            color: white;
        }
        
        .progress-step.completed .step-label {
            color: var(--success-color);
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .confirmation-message {
            text-align: center;
            padding: 30px;
        }
        
        .confirmation-message i {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 20px;
        }
        
        .confirmation-message h2 {
            color: var(--success-color);
            margin-bottom: 15px;
        }
        
        .confirmation-details {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: left;
        }
        
        .confirmation-details h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 500;
            width: 150px;
            color: #666;
        }
        
        .detail-value {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .progress-bar {
                flex-wrap: wrap;
            }
            
            .progress-step {
                width: auto;
                margin-bottom: 15px;
            }
            
            .calendar-grid {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .calendar-day {
                height: auto;
                min-height: 60px;
            }
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-footer {
            margin-top: 20px;
            text-align: right;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Reserva de Visitas Guiadas</h1>
            <p>Museo de Ciencias Naturales "Antonio Scasso"</p>
        </div>
    </header>
    
    <div class="container">
        <div class="progress-bar">
            <div class="progress-step active" id="step-1">
                <div class="step-number">1</div>
                <div class="step-label">Tipo de Visita</div>
            </div>
            <div class="progress-step" id="step-2">
                <div class="step-number">2</div>
                <div class="step-label">Fecha y Hora</div>
            </div>
            <div class="progress-step" id="step-3">
                <div class="step-number">3</div>
                <div class="step-label">Datos del Grupo</div>
            </div>
            <div class="progress-step" id="step-4">
                <div class="step-number">4</div>
                <div class="step-label">Confirmación</div>
            </div>
        </div>
        
        <div class="form-container">
            <!-- Sección 1: Tipo de Visita -->
            <div class="form-section active" id="section-1">
                <div class="form-header">
                    <h2>Seleccione el tipo de visita</h2>
                    <p>Trabajamos en colaboración con los docentes para personalizar el contenido y ofrecer experiencias interactivas.</p>
                </div>
                
                <div class="form-group">
                    <label class="required">Modalidad de visita seleccionada</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="visit-free" name="visit-type" value="Libre" required>
                            <label for="visit-free">Libres: los docentes pueden diseñar su propio recorrido y guión según los objetivos educativos de su clase.</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="visit-guided" name="visit-type" value="Guiada tradicional">
                            <label for="visit-guided">Guiadas con métodos tradicionales: coordinadas por nuestros guías, para conocer el Museo.</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="visit-themed" name="visit-type" value="Guiada con tema específico">
                            <label for="visit-themed">Guiada con tema específico</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="visit-field" name="visit-type" value="Visita de Campo">
                            <label for="visit-field">Visitas de Campo: amplía la experiencia educativa llevando la enseñanza de las ciencias naturales fuera del aula y explorando entornos naturales dentro de la ciudad.</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="visit-combined" name="visit-type" value="Visita de Campo + Museo">
                            <label for="visit-combined">Visita de Campo + Museo: incluye la parte práctica de la salida de campo con la interpretativa del museo. Tarifa especial al combinar ambas actividades.</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="visit-other" name="visit-type" value="Otro">
                            <label for="visit-other">Otros:</label>
                            <input type="text" id="visit-other-text" class="form-control" style="margin-top: 5px; display: none;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="theme-group" style="display: none;">
                    <label for="visit-theme">¿Sobre qué tema te interesa trabajar?</label>
                    <textarea id="visit-theme" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group" id="field-proposal-group" style="display: none;">
                    <label for="field-proposal">Comentá los detalles de tu propuesta de salida de campo y nos contactaremos para evaluar su factibilidad.</label>
                    <textarea id="field-proposal" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="required">¿Querés que la visita se complemente con material didáctico?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="material-yes" name="teaching-material" value="Sí" required>
                            <label for="material-yes">Sí, me interesa contar con material complementario (libros, juegos, modelos, material para manipular, otros)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="material-no" name="teaching-material" value="No">
                            <label for="material-no">Prefiero solo la experiencia en el museo</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-navigation">
                    <button class="btn" disabled>Anterior</button>
                    <button class="btn" id="next-1">Siguiente</button>
                </div>
            </div>
            
            <!-- Sección 2: Fecha y Hora -->
            <div class="form-section" id="section-2">
                <div class="form-header">
                    <h2>Seleccione fecha y horario para su visita</h2>
                    <p>El museo puede recibir visitas de grupos de lunes a jueves de 08:30 a 12:00 hs. y de 13:30 a 17:00 hs.</p>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3 class="calendar-title" id="calendar-month-year">Febrero 2023</h3>
                        <div class="calendar-nav">
                            <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                            <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-header">
                        <div class="calendar-day-header">Dom</div>
                        <div class="calendar-day-header">Lun</div>
                        <div class="calendar-day-header">Mar</div>
                        <div class="calendar-day-header">Mié</div>
                        <div class="calendar-day-header">Jue</div>
                        <div class="calendar-day-header">Vie</div>
                        <div class="calendar-day-header">Sáb</div>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-days"></div>
                    
                    <div class="time-slots" id="time-slots-am">
                        <h4>Turnos mañana (08:30 - 12:00)</h4>
                        <div class="time-slot" data-time="08:30">08:30</div>
                        <div class="time-slot" data-time="09:30">09:30</div>
                        <div class="time-slot" data-time="10:30">10:30</div>
                        <div class="time-slot" data-time="11:30">11:30</div>
                    </div>
                    
                    <div class="time-slots" id="time-slots-pm">
                        <h4>Turnos tarde (13:30 - 17:00)</h4>
                        <div class="time-slot" data-time="13:30">13:30</div>
                        <div class="time-slot" data-time="14:30">14:30</div>
                        <div class="time-slot" data-time="15:30">15:30</div>
                        <div class="time-slot" data-time="16:30">16:30</div>
                    </div>
                    
                    <input type="hidden" id="selected-date">
                    <input type="hidden" id="selected-time">
                </div>
                
                <div class="form-navigation">
                    <button class="btn" id="prev-2">Anterior</button>
                    <button class="btn" id="next-2">Siguiente</button>
                </div>
            </div>
            
            <!-- Sección 3: Datos del Grupo -->
            <div class="form-section" id="section-3">
                <div class="form-header">
                    <h2>Información del grupo y contacto</h2>
                    <p>Complete los datos del docente responsable y del grupo que visitará el museo.</p>
                </div>
                
                <div class="form-group">
                    <label for="teacher-name" class="required">Docente responsable</label>
                    <input type="text" id="teacher-name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="teacher-phone">Teléfono de contacto</label>
                    <input type="tel" id="teacher-phone" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="teacher-email" class="required">Mail de contacto</label>
                    <input type="email" id="teacher-email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="school-name" class="required">Escuela</label>
                    <input type="text" id="school-name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="school-address" class="required">Dirección</label>
                    <input type="text" id="school-address" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="group-grade" class="required">Curso</label>
                    <input type="text" id="group-grade" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="group-level" class="required">Nivel</label>
                    <input type="text" id="group-level" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="required">Cantidad de alumnos estimados</label>
                    <p>Por las características del edificio y para una mejor experiencia didáctica sugerimos no extender en más de 30 alumnos cada grupo.</p>
                    <select id="student-count" class="form-control" required>
                        <option value="">Seleccione cantidad</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="group-division">Consultas para dividir el grupo?</label>
                    <textarea id="group-division" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="additional-notes">¿Tenés alguna duda o comentario adicional?</label>
                    <textarea id="additional-notes" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-navigation">
                    <button class="btn" id="prev-3">Anterior</button>
                    <button class="btn" id="next-3">Siguiente</button>
                </div>
            </div>
            
            <!-- Sección 4: Confirmación -->
            <div class="form-section" id="section-4">
                <div class="confirmation-message">
                    <i class="fas fa-check-circle"></i>
                    <h2>¡Reserva casi lista!</h2>
                    <p>Revise los detalles de su reserva antes de confirmar.</p>
                    
                    <div class="confirmation-details">
                        <h3>Detalles de la reserva</h3>
                        
                        <div class="detail-row">
                            <div class="detail-label">Tipo de visita:</div>
                            <div class="detail-value" id="confirm-visit-type"></div>
                        </div>
                        
                        <div class="detail-row" id="confirm-theme-row" style="display: none;">
                            <div class="detail-label">Tema específico:</div>
                            <div class="detail-value" id="confirm-theme"></div>
                        </div>
                        
                        <div class="detail-row" id="confirm-field-row" style="display: none;">
                            <div class="detail-label">Propuesta de campo:</div>
                            <div class="detail-value" id="confirm-field"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Material didáctico:</div>
                            <div class="detail-value" id="confirm-material"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Fecha y hora:</div>
                            <div class="detail-value" id="confirm-datetime"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Docente:</div>
                            <div class="detail-value" id="confirm-teacher"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Contacto:</div>
                            <div class="detail-value" id="confirm-contact"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Escuela:</div>
                            <div class="detail-value" id="confirm-school"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Curso y nivel:</div>
                            <div class="detail-value" id="confirm-grade"></div>
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-label">Cantidad de alumnos:</div>
                            <div class="detail-value" id="confirm-students"></div>
                        </div>
                        
                        <div class="detail-row" id="confirm-division-row" style="display: none;">
                            <div class="detail-label">División de grupo:</div>
                            <div class="detail-value" id="confirm-division"></div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 30px;">
                        <div class="checkbox-option">
                            <input type="checkbox" id="accept-terms" required>
                            <label for="accept-terms" class="required">Acepto los términos y condiciones del museo y confirmo que la información proporcionada es correcta.</label>
                        </div>
                    </div>
                    
                    <div class="form-navigation">
                        <button class="btn" id="prev-4">Anterior</button>
                        <button class="btn btn-accent" id="submit-reservation">Confirmar Reserva</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de confirmación -->
    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>¡Reserva confirmada!</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <p>Su reserva ha sido registrada exitosamente. Recibirá un correo electrónico de confirmación en <span id="modal-email"></span> dentro de las próximas 24 horas.</p>
            
            <div class="confirmation-details" style="margin-top: 20px;">
                <h3>Instrucciones para el pago</h3>
                <p>Una vez recibida la confirmación, podrás abonar la visita mediante transferencia al alias:</p>
                <p><strong>DONBOSCO50452</strong></p>
                <p><strong>CUIT: 30-54551592-6</strong></p>
                <p>Recordá enviar comprobante del pago por WhatsApp al <strong>3364-273394 (Administración)</strong>.</p>
            </div>
            
            <div class="modal-footer">
                <button class="btn close-modal">Cerrar</button>
            </div>
        </div>
    </div>
    
    <script>
        // Variables globales
        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;
        let bookedSlots = {};
        
        // URL de tu Google Apps Script (la que me proporcionaste)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbybLmXzWaSSqvkdzIAX8ih-rOOOwXp5FTmFvnFQWslC6er7fDRcF8nlntbl9mzePTtMkA/exec';
        
        // Función para inicializar el calendario
        function initCalendar() {
            updateCalendar();
            
            // Event listeners para navegación del calendario
            document.getElementById('prev-month').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateCalendar();
            });
            
            document.getElementById('next-month').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateCalendar();
            });
        }
        
        // Función para actualizar el calendario
        function updateCalendar() {
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            // Actualizar el título del mes y año
            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('calendar-month-year').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Obtener el primer día del mes y el último día del mes
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            // Obtener el día de la semana del primer día (0 = Domingo, 1 = Lunes, etc.)
            const firstDayOfWeek = firstDay.getDay();
            
            // Obtener el último día del mes anterior
            const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
            
            // Agregar días del mes anterior
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = prevMonthLastDay - i;
                calendarDays.appendChild(dayElement);
            }
            
            // Agregar días del mes actual
            const today = new Date();
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `<span class="calendar-day-number">${i}</span>`;
                
                // Verificar si es hoy
                if (currentDate.getFullYear() === today.getFullYear() && 
                    currentDate.getMonth() === today.getMonth() && 
                    i === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Verificar si es un día disponible (lunes a jueves)
                const dayOfWeek = new Date(currentDate.getFullYear(), currentDate.getMonth(), i).getDay();
                if (dayOfWeek >= 1 && dayOfWeek <= 4) { // 1=Lunes, 2=Martes, 3=Miércoles, 4=Jueves
                    dayElement.classList.add('available');
                    
                    // Agregar evento de clic
                    dayElement.addEventListener('click', () => {
                        selectDate(i);
                    });
                } else {
                    dayElement.classList.add('booked');
                }
                
                calendarDays.appendChild(dayElement);
            }
            
            // Calcular cuántos días del próximo mes mostrar
            const totalDaysShown = firstDayOfWeek + lastDay.getDate();
            const remainingCells = totalDaysShown <= 35 ? 35 - totalDaysShown : 42 - totalDaysShown;
            
            // Agregar días del próximo mes
            for (let i = 1; i <= remainingCells; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = i;
                calendarDays.appendChild(dayElement);
            }
        }
        
        // Función para seleccionar una fecha
        function selectDate(day) {
            // Deseleccionar cualquier día previamente seleccionado
            const previouslySelected = document.querySelector('.calendar-day.selected');
            if (previouslySelected) {
                previouslySelected.classList.remove('selected');
            }
            
            // Seleccionar el nuevo día
            const days = document.querySelectorAll('.calendar-day');
            days.forEach(d => {
                if (d.textContent.includes(day) && !d.classList.contains('other-month')) {
                    d.classList.add('selected');
                    
                    // Actualizar la fecha seleccionada
                    selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    
                    // Mostrar los horarios disponibles
                    showTimeSlots();
                    
                    // Guardar la fecha seleccionada en el campo oculto
                    document.getElementById('selected-date').value = selectedDate.toISOString().split('T')[0];
                }
            });
        }
        
        // Función para mostrar los horarios disponibles
        function showTimeSlots() {
            // Ocultar todos los slots primero
            document.getElementById('time-slots-am').classList.remove('active');
            document.getElementById('time-slots-pm').classList.remove('active');
            
            // Mostrar los slots para la fecha seleccionada
            document.getElementById('time-slots-am').classList.add('active');
            document.getElementById('time-slots-pm').classList.add('active');
            
            // Deseleccionar cualquier hora previamente seleccionada
            const previouslySelected = document.querySelector('.time-slot.selected');
            if (previouslySelected) {
                previouslySelected.classList.remove('selected');
                selectedTime = null;
            }
            
            // Agregar eventos a los slots de tiempo
            const timeSlots = document.querySelectorAll('.time-slot');
            timeSlots.forEach(slot => {
                // Verificar si el slot está reservado
                const slotDateTime = `${selectedDate.toISOString().split('T')[0]}T${slot.dataset.time}:00`;
                const isBooked = bookedSlots[slotDateTime] || false;
                
                if (isBooked) {
                    slot.classList.add('booked');
                    slot.classList.remove('selected');
                } else {
                    slot.classList.remove('booked');
                    
                    slot.addEventListener('click', () => {
                        // Deseleccionar cualquier slot previamente seleccionado
                        document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                        
                        // Seleccionar el nuevo slot
                        slot.classList.add('selected');
                        selectedTime = slot.dataset.time;
                        
                        // Guardar la hora seleccionada en el campo oculto
                        document.getElementById('selected-time').value = selectedTime;
                    });
                }
            });
        }
        
        // Función para navegar entre secciones del formulario
        function navigateToSection(sectionNumber) {
            // Ocultar todas las secciones
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección actual
            document.getElementById(`section-${sectionNumber}`).classList.add('active');
            
            // Actualizar la barra de progreso
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step-${i}`);
                if (i < sectionNumber) {
                    step.classList.add('completed');
                } else if (i === sectionNumber) {
                    step.classList.add('active');
                }
            }
            
            // Desplazar al inicio del formulario
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Función para actualizar la vista de confirmación
        function updateConfirmation() {
            // Tipo de visita
            const visitType = document.querySelector('input[name="visit-type"]:checked');
            if (visitType) {
                let visitTypeText = document.querySelector(`label[for="${visitType.id}"]`).textContent.trim();
                if (visitType.id === 'visit-other' && document.getElementById('visit-other-text').value) {
                    visitTypeText = document.getElementById('visit-other-text').value;
                }
                
                document.getElementById('confirm-visit-type').textContent = visitTypeText;
                
                // Mostrar campos adicionales según el tipo de visita
                if (visitType.value === 'Guiada con tema específico') {
                    document.getElementById('confirm-theme-row').style.display = 'flex';
                    document.getElementById('confirm-theme').textContent = 
                        document.getElementById('visit-theme').value || 'No especificado';
                } else {
                    document.getElementById('confirm-theme-row').style.display = 'none';
                }
                
                if (visitType.value === 'Visita de Campo' || visitType.value === 'Visita de Campo + Museo') {
                    document.getElementById('confirm-field-row').style.display = 'flex';
                    document.getElementById('confirm-field').textContent = 
                        document.getElementById('field-proposal').value || 'No especificado';
                } else {
                    document.getElementById('confirm-field-row').style.display = 'none';
                }
            }
            
            // Material didáctico
            const material = document.querySelector('input[name="teaching-material"]:checked');
            if (material) {
                document.getElementById('confirm-material').textContent = 
                    material.id === 'material-yes' ? 'Sí, con material complementario' : 'Solo experiencia en el museo';
            }
            
            // Fecha y hora
            if (selectedDate && selectedTime) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const dateStr = selectedDate.toLocaleDateString('es-AR', options);
                document.getElementById('confirm-datetime').textContent = 
                    `${dateStr} a las ${selectedTime} hs`;
            }
            
            // Datos del docente
            document.getElementById('confirm-teacher').textContent = 
                document.getElementById('teacher-name').value;
            
            // Contacto
            const phone = document.getElementById('teacher-phone').value || 'No especificado';
            const email = document.getElementById('teacher-email').value;
            document.getElementById('confirm-contact').textContent = 
                `${phone} | ${email}`;
            
            // Escuela
            document.getElementById('confirm-school').textContent = 
                `${document.getElementById('school-name').value}, ${document.getElementById('school-address').value}`;
            
            // Curso y nivel
            document.getElementById('confirm-grade').textContent = 
                `${document.getElementById('group-grade').value} (${document.getElementById('group-level').value})`;
            
            // Cantidad de alumnos
            document.getElementById('confirm-students').textContent = 
                document.getElementById('student-count').value;
            
            // División de grupo
            const division = document.getElementById('group-division').value;
            if (division) {
                document.getElementById('confirm-division-row').style.display = 'flex';
                document.getElementById('confirm-division').textContent = division;
            } else {
                document.getElementById('confirm-division-row').style.display = 'none';
            }
        }
        
        // Cargar fechas ocupadas desde el servidor
        async function loadBookedSlots() {
            try {
                const response = await fetch(SCRIPT_URL);
                bookedSlots = await response.json();
            } catch (err) {
                console.error('Error cargando fechas ocupadas:', err);
            }
        }
        
        // Event listeners para los botones de navegación
        document.getElementById('next-1').addEventListener('click', (e) => {
            // Validar que se haya seleccionado un tipo de visita y material didáctico
            const visitType = document.querySelector('input[name="visit-type"]:checked');
            const material = document.querySelector('input[name="teaching-material"]:checked');
            
            if (!visitType || !material) {
                alert('Por favor complete todos los campos obligatorios.');
                e.preventDefault();
                return;
            }
            
            // Mostrar campos adicionales según el tipo de visita seleccionado
            if (visitType.value === 'Guiada con tema específico') {
                document.getElementById('theme-group').style.display = 'block';
            } else {
                document.getElementById('theme-group').style.display = 'none';
            }
            
            if (visitType.value === 'Visita de Campo' || visitType.value === 'Visita de Campo + Museo') {
                document.getElementById('field-proposal-group').style.display = 'block';
            } else {
                document.getElementById('field-proposal-group').style.display = 'none';
            }
            
            if (visitType.id === 'visit-other') {
                document.getElementById('visit-other-text').style.display = 'block';
            } else {
                document.getElementById('visit-other-text').style.display = 'none';
            }
            
            navigateToSection(2);
        });
        
        document.getElementById('prev-2').addEventListener('click', () => navigateToSection(1));
        document.getElementById('next-2').addEventListener('click', (e) => {
            if (!selectedDate || !selectedTime) {
                alert('Por favor seleccione una fecha y horario para su visita.');
                e.preventDefault();
                return;
            }
            navigateToSection(3);
        });
        
        document.getElementById('prev-3').addEventListener('click', () => navigateToSection(2));
        document.getElementById('next-3').addEventListener('click', (e) => {
            // Validar campos obligatorios
            const requiredFields = [
                'teacher-name', 'teacher-email', 'school-name', 
                'school-address', 'group-grade', 'group-level', 'student-count'
            ];
            
            let isValid = true;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.style.borderColor = 'var(--accent-color)';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                alert('Por favor complete todos los campos obligatorios.');
                e.preventDefault();
                return;
            }
            
            updateConfirmation();
            navigateToSection(4);
        });
        
        document.getElementById('prev-4').addEventListener('click', () => navigateToSection(3));
        
        // Event listener para el botón de confirmar reserva
        document.getElementById('submit-reservation').addEventListener('click', async (e) => {
            if (!document.getElementById('accept-terms').checked) {
                alert('Debe aceptar los términos y condiciones para continuar.');
                e.preventDefault();
                return;
            }
            
            // Recolectar todos los datos
            const visitType = document.querySelector('input[name="visit-type"]:checked');
            let visitTypeValue = visitType.value;
            if (visitType.id === 'visit-other' && document.getElementById('visit-other-text').value) {
                visitTypeValue = document.getElementById('visit-other-text').value;
            }
            
            const formData = {
                fecha: document.getElementById('selected-date').value,
                hora: document.getElementById('selected-time').value,
                tipoVisita: visitTypeValue,
                temaEspecifico: document.getElementById('visit-theme').value || '',
                propuestaCampo: document.getElementById('field-proposal').value || '',
                materialDidactico: document.querySelector('input[name="teaching-material"]:checked').value,
                docenteResponsable: document.getElementById('teacher-name').value,
                telefonoContacto: document.getElementById('teacher-phone').value,
                emailContacto: document.getElementById('teacher-email').value,
                escuela: document.getElementById('school-name').value,
                direccionEscuela: document.getElementById('school-address').value,
                curso: document.getElementById('group-grade').value,
                nivel: document.getElementById('group-level').value,
                cantidadAlumnos: document.getElementById('student-count').value,
                divisionGrupo: document.getElementById('group-division').value,
                comentariosAdicionales: document.getElementById('additional-notes').value
            };
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(formData),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Mostrar el modal de confirmación
                    document.getElementById('modal-email').textContent = formData.emailContacto;
                    document.getElementById('confirmation-modal').style.display = 'flex';
                } else {
                    alert('Error al enviar el formulario: ' + (result.message || 'Intente nuevamente más tarde'));
                }
            } catch (err) {
                alert('Error de conexión: ' + err.message);
            }
        });
        
        // Event listener para cerrar el modal
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('confirmation-modal').style.display = 'none';
        });
        
        // Event listener para el radio "Otros"
        document.getElementById('visit-other').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('visit-other-text').style.display = 'block';
            } else {
                document.getElementById('visit-other-text').style.display = 'none';
            }
        });
        
        // Inicializar el calendario cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', () => {
            initCalendar();
            loadBookedSlots();
        });
    </script>
</body>
</html>
